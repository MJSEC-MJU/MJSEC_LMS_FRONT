name: CI

on:
  pull_request:
  push:
    branches: [ "feature/**" ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4
      - uses: docker/setup-buildx-action@v3

      # 1) docker compose build + up
      - name: Compose up (build & run)
        run: |
          docker compose -f mjsec-frontend/docker-compose.ci.yml up -d
          docker compose -f mjsec-frontend/docker-compose.ci.yml ps

      # 2) 간단 Smoke‑Test (포트 8080)
      - name: Smoke test (HTTP 200)
        run: |
          # 잠깐 healthcheck 대기
          docker compose -f mjsec-frontend/docker-compose.ci.yml wait app
          # HEAD 요청으로 200 코드만 확인
          curl --fail --silent --head http://localhost:8080

      - name: Tear down
        if: always()
        run: docker compose -f mjsec-frontend/docker-compose.ci.yml down -v
