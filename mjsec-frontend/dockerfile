
FROM node:20-alpine AS builder

WORKDIR /app

# ① package.json + lockfile만 먼저 복사 → npm ci 캐시 활용
COPY package.json package-lock.json ./
RUN npm ci --omit=dev           # devDeps 제외(원하면 전체 설치로 변경 가능)

# ② 나머지 소스 전체 복사
COPY . .

# ③ vite build → /app/dist
RUN npm run build

FROM nginx:stable-alpine

# ④ 커스텀 Nginx 설정 덮어쓰기 (80, 443 등)
COPY docker/nginx/ /etc/nginx/conf.d/

# ⑤ build 결과물을 html 루트로 복사
COPY --from=builder /app/dist /usr/share/nginx/html

EXPOSE 80
STOPSIGNAL SIGTERM
CMD ["nginx" , "-g" , "daemon off;"]
